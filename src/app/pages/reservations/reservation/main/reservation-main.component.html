<form class="form" [formGroup]="formGroup">
  <div class="row w-100">
    <!-- Left Side -->
    <div class="col-md-12 col-xl-5 d-block" *ngIf="reservation?.chargingStation">
      <div class="card card-background mt-0 mb-0">
        <img
          class="front front-background"
          alt="randomImage"
          crossorigin="anonymous"
          [ngStyle]="{ 'background-size': 'contain', 'background-repeat': 'no-repeat' }"
          [src]="siteAreaImage"
          onerror="this.src='/assets/img/theme/no-image.png'"
        />
      </div>
    </div>
    <!-- Right Side -->
    <div class="col-md-12 col-xl-7">
      <div class="form-group" *ngIf="type.value === 'reserve_now'">
        <mat-form-field>
          <mat-hint *ngIf="!expiryDate.value">MM/DD/YYYY --:--</mat-hint>
          <mat-datetimepicker-toggle matSuffix [for]="expiryDatePicker" [disabled]="readOnly">
          </mat-datetimepicker-toggle>
          <mat-datetimepicker
            #expiryDatePicker
            type="datetime"
            [disabled]="readOnly"
            openOnFocus="true"
            timeInterval="5"
            mode="portrait"
          >
          </mat-datetimepicker>
          <input
            matInput
            [formControl]="expiryDate"
            placeholder="{{ 'reservations.dialog.general.expiry_date' | translate }}"
            [matDatetimepicker]="expiryDatePicker"
            [disabled]="readOnly"
            [min]="determineMinDate('expiryDate')"
            autocomplete="false"
            (click)="expiryDatePicker.open()"
            (dateChange)="onDateChanged($event, 'expiryDate')"
            (dateInput)="onDateChanged($event, 'expiryDate')"
            [required]="type.value === 'reserve_now'"
          />
          <mat-error *ngIf="expiryDate.errors?.required">
            {{ 'general.mandatory_field' | translate }}
          </mat-error>
          <mat-error *ngIf="expiryDate.errors?.invalidExpiryDate">
            {{ 'reservations.error.invalid_expiry_date' | translate }}
          </mat-error>
          <mat-error *ngIf="expiryDate.errors?.invalidDate">
            {{ 'reservations.error.invalid_date' | translate }}
          </mat-error>
        </mat-form-field>
      </div>
      <div class="form-group" *ngIf="type.value === 'planned_reservation'">
        <div>
          <mat-form-field>
            <mat-label>{{ 'reservations.select_date_range' | translate }}</mat-label>
            <mat-date-range-input
              [rangePicker]="fromDateToDatePicker"
              (click)="fromDateToDatePicker.open()"
              [min]="determineMinDate('fromDate')"
              [required]="type.value === 'planned_reservation'"
            >
              <input
                matStartDate
                [formControl]="fromDate"
                placeholder="{{ 'reservations.from_date' | translate }}"
                readonly
              />
              <input
                matEndDate
                [formControl]="toDate"
                placeholder="{{ 'reservations.to_date' | translate }}"
                readonly
              />
            </mat-date-range-input>
            <mat-hint *ngIf="!fromDate.value || !toDate.value">MM/DD/YYYY â€“ MM/DD/YYYY</mat-hint>
            <mat-datepicker-toggle matSuffix [for]="fromDateToDatePicker" [disabled]="readOnly">
            </mat-datepicker-toggle>
            <mat-date-range-picker
              #fromDateToDatePicker
              [disabled]="readOnly"
              openOnFocus="true"
            ></mat-date-range-picker>
            <mat-error *ngIf="fromDate.error?.invalidDate || fromDate.error?.invalidDate">
              {{ 'reservations.error.invalid_date' | translate }}</mat-error
            >
          </mat-form-field>
        </div>
      </div>
      <div class="row" *ngIf="type.value === 'planned_reservation'">
        <div class="col-md-6">
          <div>
            <mat-form-field>
              <mat-hint *ngIf="!arrivalTime.value">--:--</mat-hint>
              <mat-datetimepicker-toggle matSuffix [for]="arrivalTimePicker" [disabled]="readOnly">
              </mat-datetimepicker-toggle>
              <mat-datetimepicker
                #arrivalTimePicker
                type="time"
                [disabled]="readonly"
                openOnFocus="true"
                timeInterval="5"
                mode="portrait"
              >
              </mat-datetimepicker>
              <input
                matInput
                readonly="true"
                [formControl]="arrivalTime"
                placeholder="{{ 'reservations.arrival_time' | translate }}"
                [matDatetimepicker]="arrivalTimePicker"
                [min]="determineMinDate('arrivalTime')"
                autocomplete="false"
                (click)="arrivalTimePicker.open()"
                (dateChange)="onDateChanged($event, 'arrivalTime')"
                (dateInput)="onDateChanged($event, 'arrivalTime')"
                [disabled]="readonly"
              />
              <mat-error *ngIf="expiryDate.errors?.invalidDate">
                {{ 'reservations.error.invalid_date' | translate }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>
        <div class="col-md-6">
          <div>
            <mat-form-field>
              <mat-hint *ngIf="!departureTime.value">--:--</mat-hint>
              <mat-datetimepicker-toggle
                matSuffix
                [for]="departureTimePicker"
                [disabled]="readOnly"
              >
              </mat-datetimepicker-toggle>
              <mat-datetimepicker
                #departureTimePicker
                type="time"
                [disabled]="readonly"
                openOnFocus="true"
                timeInterval="5"
                mode="portrait"
              >
              </mat-datetimepicker>
              <input
                matInput
                readonly="true"
                [formControl]="departureTime"
                placeholder="{{ 'reservations.departure_time' | translate }}"
                [matDatetimepicker]="departureTimePicker"
                [min]="arrivalTime.value ?? determineMinDate('departureTime')"
                autocomplete="false"
                (click)="departureTimePicker.open()"
                (dateChange)="onDateChanged($event, 'departureTime')"
                (dateInput)="onDateChanged($event, 'departureTime')"
                [disabled]="readonly"
              />
              <mat-error *ngIf="expiryDate.errors?.invalidDate">
                {{ 'reservations.error.invalid_date' | translate }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-7">
          <div class="form-group">
            <mat-form-field>
              <input
                matInput
                type="text"
                readonly="true"
                placeholder="{{ 'reservations.chargingstation_id' | translate }}"
                [formControl]="chargingStation"
                class="form-field-popup"
                (click)="assignChargingStation()"
                required
              />
              <button
                mat-button
                matSuffix
                mat-icon-button
                aria-label="Add"
                [hidden]="readOnly"
                (click)="assignChargingStation()"
                [disabled]="!isDateProvided()"
              >
                <mat-icon>ev_station</mat-icon>
              </button>
              <mat-error *ngIf="chargingStation.errors?.required">{{
                'general.mandatory_field' | translate
              }}</mat-error>
            </mat-form-field>
          </div>
        </div>
        <div class="col-md-5">
          <div class="form-group">
            <mat-form-field>
              <input
                matInput
                type="text"
                readonly="true"
                placeholder="{{ 'reservations.connector_id' | translate }}"
                class="form-field-popup"
                [formControl]="connector"
                (click)="assignConnector()"
              />
              <button
                mat-button
                matSuffix
                mat-icon-button
                aria-label="Add"
                [hidden]="readOnly"
                [disabled]="isChargingStationAvailable()"
                (click)="assignConnector()"
              >
                <mat-icon>power</mat-icon>
              </button>
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="form-group" *ngIf="reservationsAuthorizations?.canListUsers">
        <mat-form-field>
          <input
            matInput
            type="text"
            [readonly]="true"
            placeholder="{{ 'users.title' | translate }}"
            class="form-field-popup"
            (click)="assignUser()"
            [formControl]="user"
            [required]="reservationsAuthorizations?.metadata?.userID?.mandatory"
          />
          <button
            mat-button
            matSuffix
            mat-icon-button
            aria-label="Add"
            [hidden]="readOnly"
            (click)="assignUser()"
          >
            <mat-icon>create</mat-icon>
          </button>
          <mat-error *ngIf="user.errors?.required">
            {{ 'general.mandatory_field' | translate }}
          </mat-error>
        </mat-form-field>
      </div>
      <div class="form-group">
        <mat-form-field>
          <input
            matInput
            type="text"
            [readonly]="true"
            placeholder="{{ 'tags.title' | translate }}"
            class="form-field-popup"
            (click)="assignTag()"
            [formControl]="tag"
            required
          />
          <button
            mat-button
            matSuffix
            mat-icon-button
            aria-label="Add"
            [hidden]="readOnly"
            (click)="assignTag()"
          >
            <mat-icon>create</mat-icon>
          </button>
          <mat-error *ngIf="tag.errors?.required">
            {{ 'general.mandatory_field' | translate }}
          </mat-error>
          <mat-error *ngIf="tag.errors?.inactive">
            {{ 'tags.not_active' | translate }}
          </mat-error>
        </mat-form-field>
      </div>
      <div class="form-group" *ngIf="isCarComponentActive">
        <mat-form-field>
          <input
            matInput
            type="text"
            [readonly]="true"
            placeholder="{{ 'reservations.car' | translate }}"
            class="form-field-popup"
            (click)="assignCar()"
            [formControl]="car"
          />
          <button
            mat-button
            matSuffix
            mat-icon-button
            aria-label="Add"
            [hidden]="readOnly"
            (click)="assignCar()"
          >
            <mat-icon>directions_car</mat-icon>
          </button>
        </mat-form-field>
      </div>
      <!-- <div class="form-group mt-4" *ngIf="status.value">
        <mat-form-field>
          <mat-label for="reservationStatus">{{ 'reservations.status' | translate }}</mat-label>
          <mat-select
            id="reservationStatus"
            [formControl]="status"
            (selectionChange)="onStatusChanged($event)"
          >
            <mat-option *ngFor="let status of reservationStatuses" [value]="status.key">
              {{ status.value | translate }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="status?.errors?.required">{{
            'general.mandatory_field' | translate
          }}</mat-error>
        </mat-form-field>
      </div> -->
      <div class="form-group mt-4">
        <mat-radio-group [formControl]="type">
          <div *ngFor="let type of reservationTypes" class="mt-2">
            <mat-radio-button value="{{ type.key }}" (change)="onReservationTypeChanged($event)">{{
              type.value | translate
            }}</mat-radio-button>
          </div>
          <mat-error *ngIf="type?.errors?.required">{{
            'general.mandatory_field' | translate
          }}</mat-error>
        </mat-radio-group>
      </div>
      <mat-dialog-actions class="form-group" align="end" *ngIf="reservation">
        <button mat-raised-button (click)="cancelReservation()" color="error" [disabled]="readOnly">
          {{ 'reservations.dialog.cancel_reservation.title' | translate }}
        </button>
        <button mat-raised-button (click)="cancel()">{{ 'general.cancel' | translate }}</button>
      </mat-dialog-actions>
    </div>
  </div>
</form>
